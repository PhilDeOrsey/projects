(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();function Dt(r=10){return Math.random().toString(36).substr(2,r)}function Ct(r){return new Promise(t=>setTimeout(t,r))}function it(r,t){return new Array(t).fill(r)}function jt(r,t,e){const n=[];for(let s=0;s<t;++s)n.push(it(r,e));return n}function B(r,t){const e=[];for(let n=0;n<t;++n)e.push(r(n));return e}function Et(r,t,e){const n=[];for(let s=0;s<t;++s){const i=[];for(let o=0;o<e;++o)i.push(r(s,o));n.push(i)}return n}function Rt(r,t,e=1){const n=[];if(r>=0)for(let s=0;s<r;s+=e)n.push(s);else for(let s=0;s>r;s-=e)n.push(s);return n}function ot(r,t=0){return r[r.length-1-t]}function S(r){return r.reduce((t,e)=>t+e,0)}function ct(r){return r.reduce((t,e)=>t.concat(Array.isArray(e)?ct(e):e),[])}var Ft=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Nt=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,Xt=/rgba?\(([0-9.]+), ?([0-9.]+), ?([0-9.]+)(, ?([0-9.]+))?\)/,kt=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function U(r){return r.length===1?`0${r}`:r}function K(r,t){if(t<=0)return L.from(r[0]);if(t>=1)return L.from(ot(r));const e=Math.floor(t*(r.length-1)),n=t*(r.length-1)-e;return L.mix(r[e+1],r[e],n)}function H(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*(2/3-e)*6:r}var L=class w{constructor(t,e,n,s=1){this.r=t,this.g=e,this.b=n,this.a=s}get hex(){const t=[this.r,this.g,this.b].map(n=>U(Math.round(n).toString(16))),e=this.a>=1?"":U(Math.round(this.a*255).toString(16));return`#${t.join("")}${e}`}get rgb(){return`rgba(${[this.r,this.g,this.b].map(e=>Math.round(e)).join(",")},${this.a})`}get brightness(){return(this.r*299+this.g*587+this.g*114)/1e3}get hsl(){const t=this.r/255,e=this.g/255,n=this.b/255,s=Math.max(t,e,n),i=Math.min(t,e,n),o=(i+s)/2,c=s-i;if(s===i)return[0,0,Math.round(o*100)];let a=t===s?(e-n)/c:e===s?2+(n-t)/c:4+(t-e)/c;a=Math.min(a*60,360),a<0&&(a+=360);const u=o<=.5?c/(s+i):c/(2-s-i);return[Math.round(a),Math.round(u*100),Math.round(o*100)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new w(this.r,this.g,this.b,this.a)}static from(t){return typeof t!="string"?t:t.startsWith("#")?w.fromHex(t):w.fromRgb(t)}static fromRgb(t){const e=t.match(Xt);if(!e)return new w(0,0,0);const n=e[4]?+e[5]||0:1;return new w(+e[1],+e[2],+e[3],n)}static fromHex(t){t=t.replace(Ft,(n,s,i,o)=>s+s+i+i+o+o);const e=Nt.exec(t);return e?new w(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?parseInt(e[4],16)/255:1):new w(0,0,0)}static fromHsl(t,e,n){if(t/=360,e/=100,n/=100,e===0){const u=Math.round(n*255);return new w(u,u,u)}const s=n<.5?n*(1+e):n+e-n*e,i=2*n-s,o=H(i,s,t+1/3),c=H(i,s,t),a=H(i,s,t-1/3);return new w(Math.round(o*255),Math.round(c*255),Math.round(a*255))}static rainbow(t){return B(e=>K(kt,e/(t-1)),t)}static gradient(t,e){return B(n=>K(t,n/(e-1)),e)}static shades(t,e,n=.5){const s=w.mix("#fff",t,n),i=w.mix("#000",t,n);return w.gradient([s,t,i],e)}static mix(t,e,n=.5){return t=w.from(t),e=w.from(e),new w(n*t.r+(1-n)*e.r,n*t.g+(1-n)*e.g,n*t.b+(1-n)*e.b,n*t.a+(1-n)*e.a)}static mixMany(t,e){e||(e=t.map(()=>1));const n=S(e),s=t.map(f=>f.hsl),i=s.map(f=>f[0]),o=i.map(f=>f<180?f+360:f),c=e.map((f,m)=>f*Math.sqrt(t[m].chroma)),a=S(c),u=S(i.map((f,m)=>f*c[m]))/a,g=S(o.map((f,m)=>f*c[m]))/a,M=S(i.map((f,m)=>Math.abs(f-u)*c[m])),l=S(o.map((f,m)=>Math.abs(f-g)*c[m])),d=M<=l?u:g%360,P=S(s.map((f,m)=>e[m]*f[1]))/n,$=S(s.map((f,m)=>e[m]*f[2]))/n;return w.fromHsl(d,P,$)}},Ot=Object.defineProperty,W=(r,t)=>{for(var e in t)Ot(r,e,{get:t[e],enumerable:!0})},at=1e-6;function y(r,t,e=at){return isNaN(r)||isNaN(t)?!1:Math.abs(r-t)<e}function R(r,t,e,n=at){return t>e&&([t,e]=[e,t]),r>t+n&&r<e-n}function J(r,t=1){return Math.round(r/t)*t}function O(r,t=-1/0,e=1/0){return Math.min(e,Math.max(t,r))}function Q(r,t,e=.5){return r+(t-r)*e}function v(r){return r*r}function Tt(r,t){return(r%t+t)%t}function Ht(r,t=0){const e=r.slice(0),n=ht(e);return t?n.filter(s=>s.length===t):n}function ht(r){if(r.length===1)return[[],r];const t=r.pop(),e=ht(r),n=[];for(const s of e)n.push(s,[...s,t]);return n}var Yt={};W(Yt,{determinant:()=>Ut,fill:()=>ut,identity:()=>lt,inverse:()=>gt,product:()=>T,reflection:()=>Wt,rotation:()=>Bt,scalarProduct:()=>Gt,shear:()=>Vt,sum:()=>ft,transpose:()=>pt});function ut(r,t,e){return jt(r,t,e)}function lt(r=2){const t=ut(0,r,r);for(let e=0;e<r;++e)t[e][e]=1;return t}function Bt(r){const t=Math.sin(r),e=Math.cos(r);return[[e,-t],[t,e]]}function Vt(r){return[[1,r],[0,1]]}function Wt(r){const t=Math.sin(2*r),e=Math.cos(2*r);return[[e,t],[t,-e]]}function ft(...r){const[t,...e]=r,n=e.length>1?ft(...e):e[0];if(t.length!==n.length||t[0].length!==n[0].length)throw new Error("Matrix sizes don’t match");const s=[];for(let i=0;i<t.length;++i){const o=[];for(let c=0;c<t[i].length;++c)o.push(t[i][c]+n[i][c]);s.push(o)}return s}function Gt(r,t){return r.map(e=>e.map(n=>n*t))}function T(...r){const[t,...e]=r,n=e.length>1?T(...e):e[0];if(t[0].length!==n.length)throw new Error("Matrix sizes don’t match.");const s=[];for(let i=0;i<t.length;++i){const o=[];for(let c=0;c<n[0].length;++c){let a=0;for(let u=0;u<n.length;++u)a+=t[i][u]*n[u][c];o.push(a)}s.push(o)}return s}function pt(r){const t=[];for(let e=0;e<r[0].length;++e){const n=[];for(let s=0;s<r.length;++s)n.push(r[s][e]);t.push(n)}return t}function Ut(r){if(r.length!==r[0].length)throw new Error("Not a square matrix.");const t=r.length;if(t===1)return r[0][0];if(t===2)return r[0][0]*r[1][1]-r[0][1]*r[1][0];let e=0;for(let n=0;n<t;++n){let s=r[0][n],i=r[0][n];for(let o=1;o<t;++o)i*=r[o][(n+o)%t],s*=r[o][(n-o+t)%t];e+=i-s}return e}function gt(r){const t=r.length;if(t!==r[0].length)throw new Error("Not a square matrix.");const e=lt(t),n=Et((s,i)=>r[s][i],t,t);for(let s=0;s<t;++s){let i=n[s][s];if(y(i,0)){for(let o=s+1;o<t;++o)if(n[o][s]!==0){for(let c=0;c<t;++c)[n[o][c],n[s][c]]=[n[s][c],n[o][c]],[e[o][c],e[s][c]]=[e[s][c],e[o][c]];break}if(i=n[s][s],y(i,0))throw new Error("Matrix not invertible.")}for(let o=0;o<t;++o)n[s][o]=n[s][o]/i,e[s][o]=e[s][o]/i;for(let o=0;o<t;++o){if(o===s)continue;const c=n[o][s];for(let a=0;a<t;++a)n[o][a]-=c*n[s][a],e[o][a]-=c*e[s][a]}}return e}var V={};W(V,{bernoulli:()=>yt,binomial:()=>zt,cauchy:()=>se,chiCDF:()=>oe,exponential:()=>ne,find:()=>Qt,geometric:()=>re,integer:()=>Jt,integrate:()=>xt,normal:()=>ee,normalPDF:()=>ie,poisson:()=>_t,shuffle:()=>Kt,smart:()=>Zt,uniform:()=>te,weighted:()=>dt});function Kt(r){r=r.slice(0);for(let t=r.length-1;t>0;--t){const e=Math.floor(Math.random()*(t+1));[r[t],r[e]]=[r[e],r[t]]}return r}function Jt(r,t){const e=t===void 0?0:r,n=t===void 0?r:t-r+1;return e+Math.floor(n*Math.random())}function dt(r){const t=Math.random()*S(r);let e=0;return r.findIndex(n=>(e+=n)>=t)}function Qt(r){return r[Math.floor(r.length*Math.random())]}var X=new Map;function Zt(r,t){t||(t=Dt()),X.has(t)||X.set(t,it(1,r));const e=X.get(t),n=dt(e.map(s=>s*s));return e[n]-=1,e[n]<=0&&X.set(t,e.map(s=>s+1)),n}function yt(r=.5){return Math.random()<r?1:0}function zt(r=1,t=.5){let e=0;for(let n=0;n<r;++n)e+=yt(t);return e}function _t(r=1){if(r<=0)return 0;const t=Math.exp(-r);let e=1,n=0;for(;e>t;++n)e*=Math.random();return n-1}function te(r=0,t=1){return r+(t-r)*Math.random()}function ee(r=0,t=1){const e=Math.random(),n=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*n)*Math.sqrt(t)+r}function ne(r=1){return r<=0?0:-Math.log(Math.random())/r}function re(r=.5){if(!(r<=0||r>1))return Math.floor(Math.log(Math.random())/Math.log(1-r))}function se(){let r,t,e;do t=2*Math.random()-1,e=2*Math.random()-1,r=t*t+e*e;while(r>=1);return t/e}function ie(r,t=1,e=0){return Math.exp(-((r-t)**2)/(2*e))/Math.sqrt(2*Math.PI*e)}var Z=7,z=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function mt(r){if(r<.5)return Math.PI/(Math.sin(Math.PI*r)*mt(1-r));r-=1;let t=z[0];for(let n=1;n<Z+2;n++)t+=z[n]/(r+n);const e=r+Z+.5;return Math.sqrt(2*Math.PI)*Math.pow(e,r+.5)*Math.exp(-e)*t}function xt(r,t,e,n=1){let s=0;for(let i=t;i<e;i+=n)s+=r(i)*n||0;return s}function oe(r,t){return 1-xt(n=>Math.pow(n,(t-2)/2)*Math.exp(-n/2),0,r)/Math.pow(2,t/2)/mt(t/2)}var ce={};W(ce,{bestPolynomial:()=>pe,coefficient:()=>Mt,exponential:()=>ue,linear:()=>he,logarithmic:()=>le,polynomial:()=>wt,power:()=>fe});function ae(r,t){let e=1,n=r[0];for(let s=1;s<r.length;++s)e*=t,n+=e*r[s];return n}function he(r,t=!1){let e=0,n=0,s=0,i=0;const o=r.length;for(let u=0;u<o;u++)e+=r[u][0],n+=r[u][1],s+=r[u][0]*r[u][0],i+=r[u][0]*r[u][1];if(t)return[0,i/s];const c=(o*i-e*n)/(o*s-e*e);return[n/o-c*e/o,c]}function ue(r){const t=[0,0,0,0,0,0];for(const i of r)t[0]+=i[0],t[1]+=i[1],t[2]+=i[0]*i[0]*i[1],t[3]+=i[1]*Math.log(i[1]),t[4]+=i[0]*i[1]*Math.log(i[1]),t[5]+=i[0]*i[1];const e=t[1]*t[2]-t[5]*t[5],n=Math.exp((t[2]*t[3]-t[5]*t[4])/e),s=(t[1]*t[4]-t[5]*t[3])/e;return[n,s]}function le(r){const t=[0,0,0,0],e=r.length;for(const i of r)t[0]+=Math.log(i[0]),t[1]+=i[1]*Math.log(i[0]),t[2]+=i[1],t[3]+=Math.pow(Math.log(i[0]),2);const n=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[(t[2]-n*t[0])/e,n]}function fe(r){const t=[0,0,0,0],e=r.length;for(const i of r)t[0]+=Math.log(i[0]),t[1]+=Math.log(i[1])*Math.log(i[0]),t[2]+=Math.log(i[1]),t[3]+=Math.pow(Math.log(i[0]),2);const n=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[Math.exp((t[2]-n*t[0])/e),n]}function wt(r,t=2){const e=r.map(a=>Rt(t+1).map(u=>Math.pow(a[0],u))),n=pt(e),s=r.map(a=>[a[1]]),i=T(n,e),o=gt(i);return T(o,n,s).map(a=>a[0])}function Mt(r,t){const n=r.reduce((o,c)=>o+c[1],0)/r.length,s=r.reduce((o,c)=>o+(c[1]-n)**2,0);return 1-r.reduce((o,c)=>o+(c[1]-t(c[0]))**2,0)/s}function pe(r,t=.85,e=8){if(!(r.length<=1))for(let n=1;n<e;++n){const s=wt(r,n),i=c=>ae(s,c);if(Mt(r,i)>=t)return{order:n,coefficients:s,fn:i}}}var bt=2*Math.PI;function St(r,t){const e=Math.atan2(r.y-(t?t.y:0),r.x-(t?t.x:0));return Tt(e,bt)}function _(r,t){let e,n=1/0,s=-1;for(const[i,o]of t.entries()){const c=o.project(r),a=h.distance(r,c);a<n&&(e=c,n=a,s=i)}return e?[e,s]:void 0}var h=class p{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return y(this.length,0)?new p(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new p(-this.x,-this.y)}get flip(){return new p(this.y,this.x)}get perpendicular(){return new p(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return p.distance(this,t.project(this))}clamp(t,e=0){const n=O(this.x,t.xMin+e,t.xMax-e),s=O(this.y,t.yMin+e,t.yMax-e);return new p(n,s)}changeCoordinates(t,e){const n=e.xMin+(this.x-t.xMin)/t.dx*e.dx,s=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new p(n,s)}add(t){return p.sum(this,t)}subtract(t){return p.difference(this,t)}round(t=1){return new p(J(this.x,t),J(this.y,t))}floor(){return new p(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new p(this.x%t,this.y%e)}angle(t=F){return St(this,t)}snap(t,e=5){return y(this.x,t.x,e)?new p(t.x,this.y):y(this.y,t.y,e)?new p(this.x,t.y):this}static average(...t){const e=S(t.map(s=>s.x))/t.length,n=S(t.map(s=>s.y))/t.length;return new p(e,n)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new p(t.x+e.x,t.y+e.y)}static difference(t,e){return new p(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(v(t.x-e.x)+v(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,n=.5){return new p(Q(t.x,e.x,n),Q(t.y,e.y,n))}static interpolateList(t,e=.5){const n=t.length-1,s=Math.floor(O(e,0,1)*n);return p.interpolate(t[s],t[s+1],n*e-s)}static fromPolar(t,e=1){return new p(e*Math.cos(t),e*Math.sin(t))}static random(t){const e=V.uniform(t.xMin,t.xMax),n=V.uniform(t.yMin,t.yMax);return new p(e,n)}static equals(t,e,n){return y(t.x,e.x,n)&&y(t.y,e.y,n)}static colinear(t,e,n,s){const i=t.x-e.x,o=t.y-e.y,c=e.x-n.x,a=e.y-n.y;return y(i*a,c*o,s)}transform(t){const e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],n=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new p(e,n)}rotate(t,e=F){if(y(t,0))return this;const n=this.x-e.x,s=this.y-e.y,i=Math.cos(t),o=Math.sin(t),c=n*i-s*o+e.x,a=n*o+s*i+e.y;return new p(c,a)}reflect(t){const e=t.p2.x-t.p1.x,n=t.p2.y-t.p1.y,s=this.x-t.p1.x,i=this.y-t.p1.y,o=(e*i-n*s)/(e*e+n*n),c=this.x+2*o*n,a=this.y-2*o*e;return new p(c,a)}scale(t,e=t){return new p(this.x*t,this.y*e)}shift(t,e=t){return new p(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return p.equals(this,t,e)}toString(){return`point(${this.x},${this.y})`}},F=new h(0,0);function tt(r){return["polygon","polyline","rectangle","triangle"].includes(r.type)}function C(r){return["line","ray","segment"].includes(r.type)}function vt(r){return r.type==="ray"}function At(r){return r.type==="segment"}function k(r){return r.type==="circle"}function Y(r){return r.type==="arc"}function et(r){return r.type==="angle"}var q=class j{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}get length(){return h.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return h.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y-this.slope*this.p1.x}get angle(){return St(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new h(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){return new j(t,t.add(this.p2).subtract(this.p1))}perpendicular(t){const e=this.line.project(t);return h.equals(t,e)?new j(e,e.add(this.perpendicularVector.scale(this.length/2))):new j(e,t)}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(t){const e=this.project(t);return(t.x-e.x)**2+(t.y-e.y)**2}get line(){return this.type==="line"?this:new j(this.p1,this.p2)}get ray(){return vt(this)?this:new ge(this.p1,this.p2)}get segment(){return At(this)?this:new x(this.p1,this.p2)}offset(t){const e=h.difference(this.p2,this.p1),n=h.difference(t,this.p1);return h.dot(e,n)/this.lengthSquared}project(t){return this.at(this.offset(t))}side(t,e){const n=h.difference(this.p2,this.p1),s=h.difference(t,this.p1),i=s.x*n.y-s.y*n.x;return y(i,0,e)?0:Math.sign(i)}contains(t,e){return this.side(t,e)===0}at(t){return h.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=F){return y(t,0)?this:new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return new this.constructor(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return new this.constructor(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t,e){return this.contains(t.p1,e)&&this.contains(t.p2,e)}toString(){return`line(${this.p1},${this.p2})`}},ge=class extends q{constructor(){super(...arguments),this.type="ray"}equals(r,t){return r.type!=="ray"||!this.p1.equals(r.p1,t)?!1:this.p2.equals(r.p2,t)?!0:r.contains(this.p2,t)||this.contains(r.p2,t)}contains(r,t){if(!super.contains(r,t))return!1;const e=this.offset(r);return y(e,0,t)||e>0}toString(){return`ray(${this.p1},${this.p2})`}},x=class Pt extends q{constructor(){super(...arguments),this.type="segment"}contains(t,e){return super.contains(t,e)?this.p1.equals(t,e)||this.p2.equals(t,e)?!0:y(this.p1.x,this.p2.x,e)?R(t.y,this.p1.y,this.p2.y):R(t.x,this.p1.x,this.p2.x):!1}project(t){const e=h.difference(this.p2,this.p1),n=h.difference(t,this.p1),s=O(h.dot(e,n)/this.lengthSquared,0,1);return this.p1.add(e.scale(s))}contract(t){return new Pt(this.at(t),this.at(1-t))}equals(t,e,n=!1){return t.type!=="segment"?!1:this.p1.equals(t.p1,e)&&this.p2.equals(t.p2,e)||!n&&this.p1.equals(t.p2,e)&&this.p2.equals(t.p1,e)}toString(){return`segment(${this.p1},${this.p2})`}};function de(r,t){return y(r.p1.x,r.p2.x)?R(t.y,r.p1.y,r.p2.y):R(t.x,r.p1.x,r.p2.x)}function ye(r,t){return y(r.p1.x,r.p2.x)?(t.y-r.p1.y)/(r.p2.y-r.p1.y)>0:(t.x-r.p1.x)/(r.p2.x-r.p1.x)>0}function me(r,t){return R(r.offset(t),0,1)}function xe(r,t){const e=r.p1.x-r.p2.x,n=r.p1.y-r.p2.y,s=t.p1.x-t.p2.x,i=t.p1.y-t.p2.y,o=e*i-n*s;if(y(o,0))return[];const c=r.p1.x*r.p2.y-r.p1.y*r.p2.x,a=t.p1.x*t.p2.y-t.p1.y*t.p2.x,u=c*s-e*a,g=c*i-n*a;return[new h(u/o,g/o)]}function we(r,t){const e=h.distance(r.c,t.c);if(e>r.r+t.r)return[];if(e<Math.abs(r.r-t.r))return[];if(y(e,0)&&y(r.r,t.r))return[];if(y(e,r.r+t.r))return[new q(r.c,t.c).midpoint];const n=(v(r.r)-v(t.r)+v(e))/(2*e),s=Math.sqrt(v(r.r)-v(n)),i=(t.c.x-r.c.x)*n/e+(t.c.y-r.c.y)*s/e+r.c.x,o=(t.c.y-r.c.y)*n/e-(t.c.x-r.c.x)*s/e+r.c.y,c=(t.c.x-r.c.x)*n/e-(t.c.y-r.c.y)*s/e+r.c.x,a=(t.c.y-r.c.y)*n/e+(t.c.x-r.c.x)*s/e+r.c.y;return[new h(i,o),new h(c,a)]}function nt(r,t){const e=r.p2.x-r.p1.x,n=r.p2.y-r.p1.y,s=v(e)+v(n),i=t.c.x,o=t.c.y,c=(r.p1.x-i)*(r.p2.y-o)-(r.p2.x-i)*(r.p1.y-o),a=v(t.r)*s-v(c);if(a<0)return[];const u=c*n/s,g=-c*e/s;if(y(a,0))return[t.c.shift(u,g)];const M=e*(n<0?-1:1)*Math.sqrt(a)/s,l=Math.abs(n)*Math.sqrt(a)/s;return[t.c.shift(u+M,g+l),t.c.shift(u-M,g-l)]}function Me(r,t){let e=[];const n=Y(r)?r.circle:r,s=Y(t)?t.circle:t;C(r)&&C(t)?e=xe(r,t):C(n)&&k(s)?e=nt(n,s):k(n)&&C(s)?e=nt(s,n):k(n)&&k(s)&&(e=we(n,s));for(const i of[r,t])At(i)&&(e=e.filter(o=>de(i,o))),vt(i)&&(e=e.filter(o=>ye(i,o))),Y(i)&&(e=e.filter(o=>me(i,o)));return e}function N(...r){if(r.length<2)return[];if(r.length>2)return ct(Ht(r,2).map(n=>N(...n)));let[t,e]=r;if(et(t)&&(t=t.shape(!0)),et(e)&&(e=e.shape(!0)),tt(e)&&([t,e]=[e,t]),tt(t)){const n=C(e)?t.points.filter(s=>e.contains(s)):[];for(const s of t.edges)n.push(...N(s,e));return n}return Me(t,e)}var rt=class E{constructor(...t){this.type="polygon",this.points=t}get circumference(){if(this.points.length<=1)return 0;let t=h.distance(this.points[0],ot(this.points));for(let e=1;e<this.points.length;++e)t+=h.distance(this.points[e-1],this.points[e]);return t}get signedArea(){const t=this.points,e=t.length;let n=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let s=1;s<e;++s)n+=t[s-1].x*t[s].y-t[s].x*t[s-1].y;return n/2}get area(){return Math.abs(this.signedArea)}get centroid(){const t=this.points,e=t.length;let n=0;for(let i=0;i<e;++i)n+=t[i].x;let s=0;for(let i=0;i<e;++i)s+=t[i].y;return new h(n/e,s/e)}get edges(){const t=this.points.length,e=[];for(let n=0;n<t;++n)e.push(new x(this.points[n],this.points[(n+1)%t]));return e}get radius(){const t=this.centroid,e=this.points.map(n=>h.distance(n,t));return Math.max(...e)}get oriented(){if(this.signedArea>=0)return this;const t=[...this.points].reverse();return new this.constructor(...t)}static collision(t,e,n){if(t.points.some(s=>e.contains(s))||e.points.some(s=>t.contains(s)))return!0;for(const s of t.edges)for(const i of e.edges)if(N(s,i)[0])return!0;return t.equals(e,n)}static regular(t,e=1){const n=bt/t,s=Math.PI/2-n/2,i=B(o=>h.fromPolar(s+n*o,e),t);return new E(...i)}static interpolate(t,e,n=.5){const s=t.points.map((i,o)=>h.interpolate(i,e.points[o],n));return new E(...s)}static convexHull(...t){if(t.length<=3)return new E(...t);const e=t.sort((o,c)=>o.x!==c.x?o.x-c.x:o.y-c.y),n=e.slice(0).reverse(),s=[],i=[];for(const[o,c]of[[e,s],[n,i]]){for(const a of o){for(;c.length>=2;){const u=c[c.length-1],g=c[c.length-2];if((u.x-g.x)*(a.y-g.y)>=(a.x-g.x)*(u.y-g.y))c.pop();else break}c.push(a)}c.pop()}return new E(...s.concat(i))}contains(t){let e=!1;for(const n of this.edges){if(n.p1.equals(t)||n.contains(t))return!1;if(n.p1.y>t.y==n.p2.y>t.y)continue;const s=(n.p2.x-n.p1.x)/(n.p2.y-n.p1.y);t.x<s*(t.y-n.p1.y)+n.p1.x&&(e=!e)}return e}at(t){t<0&&(t+=Math.floor(t));const e=t*this.circumference;let n=0;for(const s of this.edges){const i=s.length;if(n+i>e)return s.at((e-n)/i);n+=i}return this.points[0]}offset(t){const e=this.edges,n=_(t,this.edges)||[this.points[0],0];let s=0;for(let i=0;i<n[1];++i)s+=e[i].length;return s+=e[n[1]].offset(t)*e[n[1]].length,s/this.circumference}project(t){const e=_(t,this.edges);return e?e[0]:this.points[0]}centerAt(t=F){return this.translate(t.subtract(this.centroid))}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=F){if(y(t,0))return this;const n=this.points.map(s=>s.rotate(t,e));return new this.constructor(...n)}reflect(t){const e=this.points.map(n=>n.reflect(t));return new this.constructor(...e)}scale(t,e=t){const n=this.points.map(s=>s.scale(t,e));return new this.constructor(...n)}shift(t,e=t){const n=this.points.map(s=>s.shift(t,e));return new this.constructor(...n)}translate(t){return this.shift(t.x,t.y)}equals(t,e,n){const s=this.points.length;if(s!==t.points.length)return!1;const i=n?this:this.oriented,o=n?t:t.oriented;for(let c=0;c<s;++c)if(i.points.every((a,u)=>a.equals(o.points[(u+c)%s],e)))return!0;return!1}toString(){return`polygon(${this.points.join(",")})`}};const D=r=>r.split(" ").map(e=>{const[n,s]=e.split(",").map(Number);return new h(n,s)}),st=r=>r.map(t=>`${t.x},${t.y}`).join(" ");class be{constructor(t){this.isDragging=!1,this.currentShape=null,this.currentShapeType=null,this.offsetX=0,this.offsetY=0,this.mirrorLines=[],this.imageMap=new Map,this.reflectionSegments=[],this.config=t,this.setupMirrors(),this.initializeShapes(),this.setupReflectionSegments(),this.bindEvents()}createShape(t){const e=document.createElementNS("http://www.w3.org/2000/svg",t.type);return Object.entries(t.attributes).forEach(([n,s])=>{e.setAttribute(n,s.toString())}),e.setAttribute("data-shape-id",t.id),e.setAttribute("data-shape-type",t.type),e.setAttribute("data-draggable",t.draggable?"true":"false"),e.setAttribute("role","graphics-symbol"),e.setAttribute("aria-label",`${t.draggable?"Draggable ":""}${t.type}`),t.draggable&&(e.style.cursor="grab"),e}setupReflectionSegments(){const{x:t,y:e,width:n,height:s}=this.config.bounds,i=[new x(new h(t,e),new h(t+n,e)),new x(new h(t+n,e),new h(t+n,e+s)),new x(new h(t+n,e+s),new h(t,e+s)),new x(new h(t,e+s),new h(t,e))],o=[new x(new h(t-n,e),new h(t,e)),new x(new h(t,e+s),new h(t-n,e+s)),new x(new h(t-n,e+s),new h(t-n,e))],c=[new x(new h(t+n,e),new h(t+2*n,e)),new x(new h(t+2*n,e+s),new h(t+n,e+s)),new x(new h(t+2*n,e+s),new h(t+2*n,e))],a=[new x(new h(t,e-s),new h(t+n,e-s)),new x(new h(t+n,e-s),new h(t+n,e)),new x(new h(t,e),new h(t,e-s))],u=[new x(new h(t,e+s),new h(t,e+2*s)),new x(new h(t,e+2*s),new h(t+n,e+2*s)),new x(new h(t+n,e+2*s),new h(t+n,e+s))],g=[...o,...c,...a,...u];this.reflectionSegments=[i,g]}initializeShapes(){const{svg:t,shapes:e,bounds:n}=this.config;t.innerHTML="";const s=3,i=n.width,o=n.height,c=n.x-s*i,a=n.y-s*o,u={id:"room-boundary",type:"path",attributes:{d:g(c,a,i,o,s*2+1),fill:"none",stroke:"#cccccc",strokeWidth:"2"},draggable:!1};function g(l,d,P,$,f){let m="";for(let A=0;A<=f;A++){const I=l+A*P;m+=`M ${I},${d} L ${I},${d+f*$} `}for(let A=0;A<=f;A++){const I=d+A*$;m+=`M ${l},${I} L ${l+f*P},${I} `}return m}[u,...e].forEach(l=>{const d=this.createShape(l);this.buildImages({svg:t,shapeEl:d,shapeData:l}),t.appendChild(d)})}bindEvents(){this.config.svg.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this))}buildCircleImage(t,e){const{svg:n,shapeEl:s,shapeData:i}=t,o=this.reflectCircle(s,e),c=this.createShape({id:i.id,type:"circle",attributes:{cx:o.x,cy:o.y,r:i.attributes.r,fill:L.mix(L.fromHex(i.attributes.fill.toString()),"#fff",.35).toString()},draggable:!1});return n.appendChild(c),this.imageMap.set(t.parentId,[...this.imageMap.get(t.parentId)||[],{shape:c,line:e,id:i.id}]),c}buildPolygonImage(t,e){const{svg:n,shapeEl:s,shapeData:i}=t,o=this.reflectPolygon(s,e)||"",c=this.createShape({id:i.id,type:"polygon",attributes:{points:o,fill:L.mix(L.fromHex(i.attributes.fill.toString()),"#fff",.35).toString()},draggable:!1});return n.appendChild(c),this.imageMap.set(t.parentId,[...this.imageMap.get(t.parentId)||[],{shape:c,line:e,id:i.id}]),c}buildImages(t){const e=this.mirrorLines.length;if(t.shapeData.type==="circle")for(let n=0;n<e;n++){const s={...t,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}`},parentId:t.shapeData.id},i=this.buildCircleImage(s,this.mirrorLines[n]);for(let o=0;o<e;o++){if(n===o)continue;const c={...t,shapeEl:i,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}${o}`},parentId:t.shapeData.id+`reflection${n}`};this.buildCircleImage(c,this.mirrorLines[o])}}else if(t.shapeData.type==="polygon")for(let n=0;n<e;n++){const s={...t,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}`},parentId:t.shapeData.id},i=this.buildPolygonImage(s,this.mirrorLines[n]);for(let o=0;o<e;o++){if(n===o)continue;const c={...t,shapeEl:i,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}${o}`},parentId:t.shapeData.id+`reflection${n}`};this.buildPolygonImage(c,this.mirrorLines[o])}}}setupMirrors(){const{mirrorLocation:t,bounds:e,svg:n}=this.config;if(!t)return;const s=new h(e.x,e.y),i=new h(e.x+e.width,e.y),o=new h(e.x+e.width,e.y+e.height),c=new h(e.x,e.y+e.height);if(["top-bottom","all"].includes(t)){const a=new q(s,i),u=new q(c,o);this.mirrorLines.push(a,u),this.drawMirror(a,"MirrorTop"),this.drawMirror(u,"MirrorBot")}if(["left-right","all"].includes(t)){const a=new q(s,c),u=new q(i,o);this.mirrorLines.push(a,u),this.drawMirror(a,"MirrorLeft"),this.drawMirror(u,"MirrorRight")}}drawMirror(t,e){const[n,s]=[t.p1,t.p2];this.config.shapes.push({id:e,type:"path",attributes:{d:`M ${n.x},${n.y} L ${s.x},${s.y}`,fill:"none",stroke:"#96c8ffd9","stroke-width":6},draggable:!1})}drawSightLine(t){this.deleteRay();let e=new h(0,0);if(t.tagName.toLowerCase()==="circle"){const i=parseFloat(t.getAttribute("cx")||"0"),o=parseFloat(t.getAttribute("cy")||"0");e=new h(i,o)}else if(t.tagName.toLowerCase()==="polygon"){const i=t.getAttribute("points");e=new rt(...D(i)).centroid}const n=this.config.svg.querySelector('[data-shape-id="observer"]');let s=new h(parseFloat(n.getAttribute("cx")||"0"),parseFloat(n.getAttribute("cy")||"0"));this.drawLine(e,s,{stroke:"#DAA520",attributes:{"data-is-ray":"true","stroke-dasharray":"8,4","stroke-linecap":"round"}}),this.drawLightPath(t,e,s)}async drawLightPath(t,e,n){const s=t.getAttribute("data-shape-id").replace(/reflection\d+$/,""),i=this.config.svg.querySelector(`[data-shape-id="${s}"]`);let o=new h(0,0);if(i.tagName.toLowerCase()==="circle"){const l=parseFloat(i.getAttribute("cx")||"0"),d=parseFloat(i.getAttribute("cy")||"0");o=new h(l,d)}else if(i.tagName.toLowerCase()==="polygon"){const l=i.getAttribute("points");o=new rt(...D(l)).centroid}const c=new x(e,n);let a,u;for(const l of this.reflectionSegments[0]){const d=N(c,l);if(d.length>0){a=l,u=d[0];break}}if(!a)return;let g;for(const l of this.reflectionSegments[1]){const d=N(c,l);if(d.length>0){g=d[0].reflect(new q(a.p1,a.p2));break}}const M=[o,g,u,n].filter(l=>l!==void 0);for(let l=0;l<M.length-1;l++){const d=M[l],P=M[l+1];await Ct(250),this.drawLine(d,P,{stroke:"#39FF14",attributes:{"data-is-ray":"true","stroke-linecap":"round","stroke-width":"4",opacity:"0.7"}})}}onMouseDown(t){var c;const e=t.target;if(!e||!(e instanceof SVGGraphicsElement))return;if((c=e.getAttribute("data-shape-id"))==null?void 0:c.includes("reflection")){this.drawSightLine(e);return}if(!(e.getAttribute("data-draggable")==="true"))return;const i=e.getAttribute("data-shape-type");if(!i)return;this.isDragging=!0,this.currentShape=e,this.currentShapeType=i,this.currentShape.style.cursor="grabbing",e.classList.add("active");const o=this.config.svg.getBoundingClientRect();if(i==="circle"){const a=parseFloat(e.getAttribute("cx")||"0"),u=parseFloat(e.getAttribute("cy")||"0");this.offsetX=t.clientX-o.left-a,this.offsetY=t.clientY-o.top-u}else{const a=parseFloat(D(e.getAttribute("points"))[0].x.toString()),u=parseFloat(D(e.getAttribute("points"))[0].y.toString());this.offsetX=t.clientX-o.left-a,this.offsetY=t.clientY-o.top-u}}deleteRay(){this.config.svg.querySelectorAll('[data-is-ray="true"]').forEach(e=>e.remove())}onMouseMove(t){if(!this.isDragging||!this.currentShape||!this.currentShapeType)return;this.deleteRay();const e=this.config.svg.getBoundingClientRect(),n=this.config.bounds;let s=t.clientX-e.left-this.offsetX,i=t.clientY-e.top-this.offsetY;if(this.currentShapeType==="circle"){const o=parseFloat(this.currentShape.getAttribute("r")||"0");s=Math.max(n.x+o,Math.min(s,n.x+n.width-o)),i=Math.max(n.y+o,Math.min(i,n.y+n.height-o)),this.currentShape.setAttribute("cx",s.toString()),this.currentShape.setAttribute("cy",i.toString());const c=this.imageMap.get(this.currentShape.getAttribute("data-shape-id"));for(const a of c||[]){const u=this.reflectCircle(this.currentShape,a.line);a.shape.setAttribute("cx",u.x.toString()),a.shape.setAttribute("cy",u.y.toString());const g=this.imageMap.get(a.id);for(const M of g||[]){const l=this.reflectCircle(a.shape,M.line);M.shape.setAttribute("cx",l.x.toString()),M.shape.setAttribute("cy",l.y.toString())}}}else if(this.currentShapeType==="polygon"){const o=this.currentShape.getAttribute("points");if(!o)return;const c=D(o),a=Math.min(...c.map(b=>b.x)),u=Math.min(...c.map(b=>b.y)),g=Math.max(...c.map(b=>b.x)),M=Math.max(...c.map(b=>b.y)),l=g-a,d=M-u,P=Math.max(n.x,Math.min(s,n.x+n.width-l)),$=Math.max(n.y,Math.min(i,n.y+n.height-d)),f=P-a,m=$-u,A=c.map(b=>new h(b.x+f,b.y+m)),I=st(A);this.currentShape.setAttribute("points",I);const qt=this.imageMap.get(this.currentShape.getAttribute("data-shape-id"));for(const b of qt||[]){const It=this.reflectPolygon(this.currentShape,b.line);b.shape.setAttribute("points",It);const Lt=this.imageMap.get(b.id);for(const G of Lt||[]){const $t=this.reflectPolygon(b.shape,G.line);G.shape.setAttribute("points",$t)}}}}onMouseUp(){var t;this.currentShape&&(this.currentShape.style.cursor="grab"),(t=this.currentShape)==null||t.classList.remove("active"),this.isDragging=!1,this.currentShape=null,this.currentShapeType=null}reflectCircle(t,e){if(t.getAttribute("data-shape-type")!=="circle")return;const n=parseFloat(t.getAttribute("cx")||"0"),s=parseFloat(t.getAttribute("cy")||"0");return new h(n,s).reflect(e)}reflectPolygon(t,e){if(t.getAttribute("data-shape-type")!=="polygon")return;const s=D(t.getAttribute("points")).map(i=>i.reflect(e));return st(s)}drawLine(t,e,n={}){const{stroke:s="#000000",strokeWidth:i=2,id:o=`line-${Math.random().toString(36).substr(2,9)}`,draggable:c=!1,attributes:a={}}=n,u={id:o,type:"path",attributes:{d:`M ${t.x},${t.y} L ${e.x},${e.y}`,fill:"none",stroke:s,"stroke-width":i,...a},draggable:c},g=this.createShape(u);return this.config.svg.appendChild(g),g}}const Se=[{id:"observer",type:"circle",attributes:{cx:500,cy:350,r:15,fill:"#0000c8"},draggable:!0},{id:"poly1",type:"polygon",attributes:{points:"450,400 525,400 525,450 475,440 450,450 475,425",fill:"#c80000"},draggable:!0}],ve={x:400,y:300,width:200,height:200},Ae={svg:document.querySelector("svg"),shapes:Se,bounds:ve,mirrorLocation:"all"};new be(Ae);
