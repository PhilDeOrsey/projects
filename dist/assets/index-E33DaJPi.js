(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();function Dt(r=10){return Math.random().toString(36).substr(2,r)}function rt(r,t){return new Array(t).fill(r)}function Lt(r,t,e){const n=[];for(let s=0;s<t;++s)n.push(rt(r,e));return n}function k(r,t){const e=[];for(let n=0;n<t;++n)e.push(r(n));return e}function jt(r,t,e){const n=[];for(let s=0;s<t;++s){const i=[];for(let o=0;o<e;++o)i.push(r(s,o));n.push(i)}return n}function Ct(r,t,e=1){const n=[];if(r>=0)for(let s=0;s<r;s+=e)n.push(s);else for(let s=0;s>r;s-=e)n.push(s);return n}function st(r,t=0){return r[r.length-1-t]}function b(r){return r.reduce((t,e)=>t+e,0)}function it(r){return r.reduce((t,e)=>t.concat(Array.isArray(e)?it(e):e),[])}var Et=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Rt=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,Xt=/rgba?\(([0-9.]+), ?([0-9.]+), ?([0-9.]+)(, ?([0-9.]+))?\)/,Ft=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function G(r){return r.length===1?`0${r}`:r}function U(r,t){if(t<=0)return P.from(r[0]);if(t>=1)return P.from(st(r));const e=Math.floor(t*(r.length-1)),n=t*(r.length-1)-e;return P.mix(r[e+1],r[e],n)}function T(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*(2/3-e)*6:r}var P=class y{constructor(t,e,n,s=1){this.r=t,this.g=e,this.b=n,this.a=s}get hex(){const t=[this.r,this.g,this.b].map(n=>G(Math.round(n).toString(16))),e=this.a>=1?"":G(Math.round(this.a*255).toString(16));return`#${t.join("")}${e}`}get rgb(){return`rgba(${[this.r,this.g,this.b].map(e=>Math.round(e)).join(",")},${this.a})`}get brightness(){return(this.r*299+this.g*587+this.g*114)/1e3}get hsl(){const t=this.r/255,e=this.g/255,n=this.b/255,s=Math.max(t,e,n),i=Math.min(t,e,n),o=(i+s)/2,a=s-i;if(s===i)return[0,0,Math.round(o*100)];let c=t===s?(e-n)/a:e===s?2+(n-t)/a:4+(t-e)/a;c=Math.min(c*60,360),c<0&&(c+=360);const h=o<=.5?a/(s+i):a/(2-s-i);return[Math.round(c),Math.round(h*100),Math.round(o*100)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new y(this.r,this.g,this.b,this.a)}static from(t){return typeof t!="string"?t:t.startsWith("#")?y.fromHex(t):y.fromRgb(t)}static fromRgb(t){const e=t.match(Xt);if(!e)return new y(0,0,0);const n=e[4]?+e[5]||0:1;return new y(+e[1],+e[2],+e[3],n)}static fromHex(t){t=t.replace(Et,(n,s,i,o)=>s+s+i+i+o+o);const e=Rt.exec(t);return e?new y(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?parseInt(e[4],16)/255:1):new y(0,0,0)}static fromHsl(t,e,n){if(t/=360,e/=100,n/=100,e===0){const h=Math.round(n*255);return new y(h,h,h)}const s=n<.5?n*(1+e):n+e-n*e,i=2*n-s,o=T(i,s,t+1/3),a=T(i,s,t),c=T(i,s,t-1/3);return new y(Math.round(o*255),Math.round(a*255),Math.round(c*255))}static rainbow(t){return k(e=>U(Ft,e/(t-1)),t)}static gradient(t,e){return k(n=>U(t,n/(e-1)),e)}static shades(t,e,n=.5){const s=y.mix("#fff",t,n),i=y.mix("#000",t,n);return y.gradient([s,t,i],e)}static mix(t,e,n=.5){return t=y.from(t),e=y.from(e),new y(n*t.r+(1-n)*e.r,n*t.g+(1-n)*e.g,n*t.b+(1-n)*e.b,n*t.a+(1-n)*e.a)}static mixMany(t,e){e||(e=t.map(()=>1));const n=b(e),s=t.map(l=>l.hsl),i=s.map(l=>l[0]),o=i.map(l=>l<180?l+360:l),a=e.map((l,d)=>l*Math.sqrt(t[d].chroma)),c=b(a),h=b(i.map((l,d)=>l*a[d]))/c,p=b(o.map((l,d)=>l*a[d]))/c,M=b(i.map((l,d)=>Math.abs(l-h)*a[d])),m=b(o.map((l,d)=>Math.abs(l-p)*a[d])),S=M<=m?h:p%360,I=b(s.map((l,d)=>e[d]*l[1]))/n,$=b(s.map((l,d)=>e[d]*l[2]))/n;return y.fromHsl(S,I,$)}},Nt=Object.defineProperty,V=(r,t)=>{for(var e in t)Nt(r,e,{get:t[e],enumerable:!0})},ot=1e-6;function g(r,t,e=ot){return isNaN(r)||isNaN(t)?!1:Math.abs(r-t)<e}function E(r,t,e,n=ot){return t>e&&([t,e]=[e,t]),r>t+n&&r<e-n}function z(r,t=1){return Math.round(r/t)*t}function N(r,t=-1/0,e=1/0){return Math.min(e,Math.max(t,r))}function K(r,t,e=.5){return r+(t-r)*e}function w(r){return r*r}function Ot(r,t){return(r%t+t)%t}function Tt(r,t=0){const e=r.slice(0),n=at(e);return t?n.filter(s=>s.length===t):n}function at(r){if(r.length===1)return[[],r];const t=r.pop(),e=at(r),n=[];for(const s of e)n.push(s,[...s,t]);return n}var Ht={};V(Ht,{determinant:()=>Wt,fill:()=>ct,identity:()=>ht,inverse:()=>ft,product:()=>O,reflection:()=>Bt,rotation:()=>kt,scalarProduct:()=>Vt,shear:()=>Yt,sum:()=>ut,transpose:()=>lt});function ct(r,t,e){return Lt(r,t,e)}function ht(r=2){const t=ct(0,r,r);for(let e=0;e<r;++e)t[e][e]=1;return t}function kt(r){const t=Math.sin(r),e=Math.cos(r);return[[e,-t],[t,e]]}function Yt(r){return[[1,r],[0,1]]}function Bt(r){const t=Math.sin(2*r),e=Math.cos(2*r);return[[e,t],[t,-e]]}function ut(...r){const[t,...e]=r,n=e.length>1?ut(...e):e[0];if(t.length!==n.length||t[0].length!==n[0].length)throw new Error("Matrix sizes don’t match");const s=[];for(let i=0;i<t.length;++i){const o=[];for(let a=0;a<t[i].length;++a)o.push(t[i][a]+n[i][a]);s.push(o)}return s}function Vt(r,t){return r.map(e=>e.map(n=>n*t))}function O(...r){const[t,...e]=r,n=e.length>1?O(...e):e[0];if(t[0].length!==n.length)throw new Error("Matrix sizes don’t match.");const s=[];for(let i=0;i<t.length;++i){const o=[];for(let a=0;a<n[0].length;++a){let c=0;for(let h=0;h<n.length;++h)c+=t[i][h]*n[h][a];o.push(c)}s.push(o)}return s}function lt(r){const t=[];for(let e=0;e<r[0].length;++e){const n=[];for(let s=0;s<r.length;++s)n.push(r[s][e]);t.push(n)}return t}function Wt(r){if(r.length!==r[0].length)throw new Error("Not a square matrix.");const t=r.length;if(t===1)return r[0][0];if(t===2)return r[0][0]*r[1][1]-r[0][1]*r[1][0];let e=0;for(let n=0;n<t;++n){let s=r[0][n],i=r[0][n];for(let o=1;o<t;++o)i*=r[o][(n+o)%t],s*=r[o][(n-o+t)%t];e+=i-s}return e}function ft(r){const t=r.length;if(t!==r[0].length)throw new Error("Not a square matrix.");const e=ht(t),n=jt((s,i)=>r[s][i],t,t);for(let s=0;s<t;++s){let i=n[s][s];if(g(i,0)){for(let o=s+1;o<t;++o)if(n[o][s]!==0){for(let a=0;a<t;++a)[n[o][a],n[s][a]]=[n[s][a],n[o][a]],[e[o][a],e[s][a]]=[e[s][a],e[o][a]];break}if(i=n[s][s],g(i,0))throw new Error("Matrix not invertible.")}for(let o=0;o<t;++o)n[s][o]=n[s][o]/i,e[s][o]=e[s][o]/i;for(let o=0;o<t;++o){if(o===s)continue;const a=n[o][s];for(let c=0;c<t;++c)n[o][c]-=a*n[s][c],e[o][c]-=a*e[s][c]}}return e}var Y={};V(Y,{bernoulli:()=>gt,binomial:()=>Jt,cauchy:()=>ne,chiCDF:()=>se,exponential:()=>te,find:()=>zt,geometric:()=>ee,integer:()=>Ut,integrate:()=>yt,normal:()=>_t,normalPDF:()=>re,poisson:()=>Qt,shuffle:()=>Gt,smart:()=>Kt,uniform:()=>Zt,weighted:()=>pt});function Gt(r){r=r.slice(0);for(let t=r.length-1;t>0;--t){const e=Math.floor(Math.random()*(t+1));[r[t],r[e]]=[r[e],r[t]]}return r}function Ut(r,t){const e=t===void 0?0:r,n=t===void 0?r:t-r+1;return e+Math.floor(n*Math.random())}function pt(r){const t=Math.random()*b(r);let e=0;return r.findIndex(n=>(e+=n)>=t)}function zt(r){return r[Math.floor(r.length*Math.random())]}var X=new Map;function Kt(r,t){t||(t=Dt()),X.has(t)||X.set(t,rt(1,r));const e=X.get(t),n=pt(e.map(s=>s*s));return e[n]-=1,e[n]<=0&&X.set(t,e.map(s=>s+1)),n}function gt(r=.5){return Math.random()<r?1:0}function Jt(r=1,t=.5){let e=0;for(let n=0;n<r;++n)e+=gt(t);return e}function Qt(r=1){if(r<=0)return 0;const t=Math.exp(-r);let e=1,n=0;for(;e>t;++n)e*=Math.random();return n-1}function Zt(r=0,t=1){return r+(t-r)*Math.random()}function _t(r=0,t=1){const e=Math.random(),n=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*n)*Math.sqrt(t)+r}function te(r=1){return r<=0?0:-Math.log(Math.random())/r}function ee(r=.5){if(!(r<=0||r>1))return Math.floor(Math.log(Math.random())/Math.log(1-r))}function ne(){let r,t,e;do t=2*Math.random()-1,e=2*Math.random()-1,r=t*t+e*e;while(r>=1);return t/e}function re(r,t=1,e=0){return Math.exp(-((r-t)**2)/(2*e))/Math.sqrt(2*Math.PI*e)}var J=7,Q=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function dt(r){if(r<.5)return Math.PI/(Math.sin(Math.PI*r)*dt(1-r));r-=1;let t=Q[0];for(let n=1;n<J+2;n++)t+=Q[n]/(r+n);const e=r+J+.5;return Math.sqrt(2*Math.PI)*Math.pow(e,r+.5)*Math.exp(-e)*t}function yt(r,t,e,n=1){let s=0;for(let i=t;i<e;i+=n)s+=r(i)*n||0;return s}function se(r,t){return 1-yt(n=>Math.pow(n,(t-2)/2)*Math.exp(-n/2),0,r)/Math.pow(2,t/2)/dt(t/2)}var ie={};V(ie,{bestPolynomial:()=>le,coefficient:()=>xt,exponential:()=>ce,linear:()=>ae,logarithmic:()=>he,polynomial:()=>mt,power:()=>ue});function oe(r,t){let e=1,n=r[0];for(let s=1;s<r.length;++s)e*=t,n+=e*r[s];return n}function ae(r,t=!1){let e=0,n=0,s=0,i=0;const o=r.length;for(let h=0;h<o;h++)e+=r[h][0],n+=r[h][1],s+=r[h][0]*r[h][0],i+=r[h][0]*r[h][1];if(t)return[0,i/s];const a=(o*i-e*n)/(o*s-e*e);return[n/o-a*e/o,a]}function ce(r){const t=[0,0,0,0,0,0];for(const i of r)t[0]+=i[0],t[1]+=i[1],t[2]+=i[0]*i[0]*i[1],t[3]+=i[1]*Math.log(i[1]),t[4]+=i[0]*i[1]*Math.log(i[1]),t[5]+=i[0]*i[1];const e=t[1]*t[2]-t[5]*t[5],n=Math.exp((t[2]*t[3]-t[5]*t[4])/e),s=(t[1]*t[4]-t[5]*t[3])/e;return[n,s]}function he(r){const t=[0,0,0,0],e=r.length;for(const i of r)t[0]+=Math.log(i[0]),t[1]+=i[1]*Math.log(i[0]),t[2]+=i[1],t[3]+=Math.pow(Math.log(i[0]),2);const n=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[(t[2]-n*t[0])/e,n]}function ue(r){const t=[0,0,0,0],e=r.length;for(const i of r)t[0]+=Math.log(i[0]),t[1]+=Math.log(i[1])*Math.log(i[0]),t[2]+=Math.log(i[1]),t[3]+=Math.pow(Math.log(i[0]),2);const n=(e*t[1]-t[2]*t[0])/(e*t[3]-t[0]*t[0]);return[Math.exp((t[2]-n*t[0])/e),n]}function mt(r,t=2){const e=r.map(c=>Ct(t+1).map(h=>Math.pow(c[0],h))),n=lt(e),s=r.map(c=>[c[1]]),i=O(n,e),o=ft(i);return O(o,n,s).map(c=>c[0])}function xt(r,t){const n=r.reduce((o,a)=>o+a[1],0)/r.length,s=r.reduce((o,a)=>o+(a[1]-n)**2,0);return 1-r.reduce((o,a)=>o+(a[1]-t(a[0]))**2,0)/s}function le(r,t=.85,e=8){if(!(r.length<=1))for(let n=1;n<e;++n){const s=mt(r,n),i=a=>oe(s,a);if(xt(r,i)>=t)return{order:n,coefficients:s,fn:i}}}var Mt=2*Math.PI;function bt(r,t){const e=Math.atan2(r.y-(t?t.y:0),r.x-(t?t.x:0));return Ot(e,Mt)}function Z(r,t){let e,n=1/0,s=-1;for(const[i,o]of t.entries()){const a=o.project(r),c=u.distance(r,a);c<n&&(e=a,n=c,s=i)}return e?[e,s]:void 0}var u=class f{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return g(this.length,0)?new f(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new f(-this.x,-this.y)}get flip(){return new f(this.y,this.x)}get perpendicular(){return new f(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return f.distance(this,t.project(this))}clamp(t,e=0){const n=N(this.x,t.xMin+e,t.xMax-e),s=N(this.y,t.yMin+e,t.yMax-e);return new f(n,s)}changeCoordinates(t,e){const n=e.xMin+(this.x-t.xMin)/t.dx*e.dx,s=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new f(n,s)}add(t){return f.sum(this,t)}subtract(t){return f.difference(this,t)}round(t=1){return new f(z(this.x,t),z(this.y,t))}floor(){return new f(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new f(this.x%t,this.y%e)}angle(t=R){return bt(this,t)}snap(t,e=5){return g(this.x,t.x,e)?new f(t.x,this.y):g(this.y,t.y,e)?new f(this.x,t.y):this}static average(...t){const e=b(t.map(s=>s.x))/t.length,n=b(t.map(s=>s.y))/t.length;return new f(e,n)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new f(t.x+e.x,t.y+e.y)}static difference(t,e){return new f(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(w(t.x-e.x)+w(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,n=.5){return new f(K(t.x,e.x,n),K(t.y,e.y,n))}static interpolateList(t,e=.5){const n=t.length-1,s=Math.floor(N(e,0,1)*n);return f.interpolate(t[s],t[s+1],n*e-s)}static fromPolar(t,e=1){return new f(e*Math.cos(t),e*Math.sin(t))}static random(t){const e=Y.uniform(t.xMin,t.xMax),n=Y.uniform(t.yMin,t.yMax);return new f(e,n)}static equals(t,e,n){return g(t.x,e.x,n)&&g(t.y,e.y,n)}static colinear(t,e,n,s){const i=t.x-e.x,o=t.y-e.y,a=e.x-n.x,c=e.y-n.y;return g(i*c,a*o,s)}transform(t){const e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],n=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new f(e,n)}rotate(t,e=R){if(g(t,0))return this;const n=this.x-e.x,s=this.y-e.y,i=Math.cos(t),o=Math.sin(t),a=n*i-s*o+e.x,c=n*o+s*i+e.y;return new f(a,c)}reflect(t){const e=t.p2.x-t.p1.x,n=t.p2.y-t.p1.y,s=this.x-t.p1.x,i=this.y-t.p1.y,o=(e*i-n*s)/(e*e+n*n),a=this.x+2*o*n,c=this.y-2*o*e;return new f(a,c)}scale(t,e=t){return new f(this.x*t,this.y*e)}shift(t,e=t){return new f(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}equals(t,e){return f.equals(this,t,e)}toString(){return`point(${this.x},${this.y})`}},R=new u(0,0);function _(r){return["polygon","polyline","rectangle","triangle"].includes(r.type)}function L(r){return["line","ray","segment"].includes(r.type)}function wt(r){return r.type==="ray"}function St(r){return r.type==="segment"}function F(r){return r.type==="circle"}function H(r){return r.type==="arc"}function tt(r){return r.type==="angle"}var q=class j{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}get length(){return u.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return u.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y-this.slope*this.p1.x}get angle(){return bt(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new u(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){return new j(t,t.add(this.p2).subtract(this.p1))}perpendicular(t){const e=this.line.project(t);return u.equals(t,e)?new j(e,e.add(this.perpendicularVector.scale(this.length/2))):new j(e,t)}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(t){const e=this.project(t);return(t.x-e.x)**2+(t.y-e.y)**2}get line(){return this.type==="line"?this:new j(this.p1,this.p2)}get ray(){return wt(this)?this:new fe(this.p1,this.p2)}get segment(){return St(this)?this:new vt(this.p1,this.p2)}offset(t){const e=u.difference(this.p2,this.p1),n=u.difference(t,this.p1);return u.dot(e,n)/this.lengthSquared}project(t){return this.at(this.offset(t))}side(t,e){const n=u.difference(this.p2,this.p1),s=u.difference(t,this.p1),i=s.x*n.y-s.y*n.x;return g(i,0,e)?0:Math.sign(i)}contains(t,e){return this.side(t,e)===0}at(t){return u.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=R){return g(t,0)?this:new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return new this.constructor(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return new this.constructor(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t,e){return this.contains(t.p1,e)&&this.contains(t.p2,e)}toString(){return`line(${this.p1},${this.p2})`}},fe=class extends q{constructor(){super(...arguments),this.type="ray"}equals(r,t){return r.type!=="ray"||!this.p1.equals(r.p1,t)?!1:this.p2.equals(r.p2,t)?!0:r.contains(this.p2,t)||this.contains(r.p2,t)}contains(r,t){if(!super.contains(r,t))return!1;const e=this.offset(r);return g(e,0,t)||e>0}toString(){return`ray(${this.p1},${this.p2})`}},vt=class At extends q{constructor(){super(...arguments),this.type="segment"}contains(t,e){return super.contains(t,e)?this.p1.equals(t,e)||this.p2.equals(t,e)?!0:g(this.p1.x,this.p2.x,e)?E(t.y,this.p1.y,this.p2.y):E(t.x,this.p1.x,this.p2.x):!1}project(t){const e=u.difference(this.p2,this.p1),n=u.difference(t,this.p1),s=N(u.dot(e,n)/this.lengthSquared,0,1);return this.p1.add(e.scale(s))}contract(t){return new At(this.at(t),this.at(1-t))}equals(t,e,n=!1){return t.type!=="segment"?!1:this.p1.equals(t.p1,e)&&this.p2.equals(t.p2,e)||!n&&this.p1.equals(t.p2,e)&&this.p2.equals(t.p1,e)}toString(){return`segment(${this.p1},${this.p2})`}};function pe(r,t){return g(r.p1.x,r.p2.x)?E(t.y,r.p1.y,r.p2.y):E(t.x,r.p1.x,r.p2.x)}function ge(r,t){return g(r.p1.x,r.p2.x)?(t.y-r.p1.y)/(r.p2.y-r.p1.y)>0:(t.x-r.p1.x)/(r.p2.x-r.p1.x)>0}function de(r,t){return E(r.offset(t),0,1)}function ye(r,t){const e=r.p1.x-r.p2.x,n=r.p1.y-r.p2.y,s=t.p1.x-t.p2.x,i=t.p1.y-t.p2.y,o=e*i-n*s;if(g(o,0))return[];const a=r.p1.x*r.p2.y-r.p1.y*r.p2.x,c=t.p1.x*t.p2.y-t.p1.y*t.p2.x,h=a*s-e*c,p=a*i-n*c;return[new u(h/o,p/o)]}function me(r,t){const e=u.distance(r.c,t.c);if(e>r.r+t.r)return[];if(e<Math.abs(r.r-t.r))return[];if(g(e,0)&&g(r.r,t.r))return[];if(g(e,r.r+t.r))return[new q(r.c,t.c).midpoint];const n=(w(r.r)-w(t.r)+w(e))/(2*e),s=Math.sqrt(w(r.r)-w(n)),i=(t.c.x-r.c.x)*n/e+(t.c.y-r.c.y)*s/e+r.c.x,o=(t.c.y-r.c.y)*n/e-(t.c.x-r.c.x)*s/e+r.c.y,a=(t.c.x-r.c.x)*n/e-(t.c.y-r.c.y)*s/e+r.c.x,c=(t.c.y-r.c.y)*n/e+(t.c.x-r.c.x)*s/e+r.c.y;return[new u(i,o),new u(a,c)]}function et(r,t){const e=r.p2.x-r.p1.x,n=r.p2.y-r.p1.y,s=w(e)+w(n),i=t.c.x,o=t.c.y,a=(r.p1.x-i)*(r.p2.y-o)-(r.p2.x-i)*(r.p1.y-o),c=w(t.r)*s-w(a);if(c<0)return[];const h=a*n/s,p=-a*e/s;if(g(c,0))return[t.c.shift(h,p)];const M=e*(n<0?-1:1)*Math.sqrt(c)/s,m=Math.abs(n)*Math.sqrt(c)/s;return[t.c.shift(h+M,p+m),t.c.shift(h-M,p-m)]}function xe(r,t){let e=[];const n=H(r)?r.circle:r,s=H(t)?t.circle:t;L(r)&&L(t)?e=ye(r,t):L(n)&&F(s)?e=et(n,s):F(n)&&L(s)?e=et(s,n):F(n)&&F(s)&&(e=me(n,s));for(const i of[r,t])St(i)&&(e=e.filter(o=>pe(i,o))),wt(i)&&(e=e.filter(o=>ge(i,o))),H(i)&&(e=e.filter(o=>de(i,o)));return e}function B(...r){if(r.length<2)return[];if(r.length>2)return it(Tt(r,2).map(n=>B(...n)));let[t,e]=r;if(tt(t)&&(t=t.shape(!0)),tt(e)&&(e=e.shape(!0)),_(e)&&([t,e]=[e,t]),_(t)){const n=L(e)?t.points.filter(s=>e.contains(s)):[];for(const s of t.edges)n.push(...B(s,e));return n}return xe(t,e)}var Me=class C{constructor(...t){this.type="polygon",this.points=t}get circumference(){if(this.points.length<=1)return 0;let t=u.distance(this.points[0],st(this.points));for(let e=1;e<this.points.length;++e)t+=u.distance(this.points[e-1],this.points[e]);return t}get signedArea(){const t=this.points,e=t.length;let n=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let s=1;s<e;++s)n+=t[s-1].x*t[s].y-t[s].x*t[s-1].y;return n/2}get area(){return Math.abs(this.signedArea)}get centroid(){const t=this.points,e=t.length;let n=0;for(let i=0;i<e;++i)n+=t[i].x;let s=0;for(let i=0;i<e;++i)s+=t[i].y;return new u(n/e,s/e)}get edges(){const t=this.points.length,e=[];for(let n=0;n<t;++n)e.push(new vt(this.points[n],this.points[(n+1)%t]));return e}get radius(){const t=this.centroid,e=this.points.map(n=>u.distance(n,t));return Math.max(...e)}get oriented(){if(this.signedArea>=0)return this;const t=[...this.points].reverse();return new this.constructor(...t)}static collision(t,e,n){if(t.points.some(s=>e.contains(s))||e.points.some(s=>t.contains(s)))return!0;for(const s of t.edges)for(const i of e.edges)if(B(s,i)[0])return!0;return t.equals(e,n)}static regular(t,e=1){const n=Mt/t,s=Math.PI/2-n/2,i=k(o=>u.fromPolar(s+n*o,e),t);return new C(...i)}static interpolate(t,e,n=.5){const s=t.points.map((i,o)=>u.interpolate(i,e.points[o],n));return new C(...s)}static convexHull(...t){if(t.length<=3)return new C(...t);const e=t.sort((o,a)=>o.x!==a.x?o.x-a.x:o.y-a.y),n=e.slice(0).reverse(),s=[],i=[];for(const[o,a]of[[e,s],[n,i]]){for(const c of o){for(;a.length>=2;){const h=a[a.length-1],p=a[a.length-2];if((h.x-p.x)*(c.y-p.y)>=(c.x-p.x)*(h.y-p.y))a.pop();else break}a.push(c)}a.pop()}return new C(...s.concat(i))}contains(t){let e=!1;for(const n of this.edges){if(n.p1.equals(t)||n.contains(t))return!1;if(n.p1.y>t.y==n.p2.y>t.y)continue;const s=(n.p2.x-n.p1.x)/(n.p2.y-n.p1.y);t.x<s*(t.y-n.p1.y)+n.p1.x&&(e=!e)}return e}at(t){t<0&&(t+=Math.floor(t));const e=t*this.circumference;let n=0;for(const s of this.edges){const i=s.length;if(n+i>e)return s.at((e-n)/i);n+=i}return this.points[0]}offset(t){const e=this.edges,n=Z(t,this.edges)||[this.points[0],0];let s=0;for(let i=0;i<n[1];++i)s+=e[i].length;return s+=e[n[1]].offset(t)*e[n[1]].length,s/this.circumference}project(t){const e=Z(t,this.edges);return e?e[0]:this.points[0]}centerAt(t=R){return this.translate(t.subtract(this.centroid))}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=R){if(g(t,0))return this;const n=this.points.map(s=>s.rotate(t,e));return new this.constructor(...n)}reflect(t){const e=this.points.map(n=>n.reflect(t));return new this.constructor(...e)}scale(t,e=t){const n=this.points.map(s=>s.scale(t,e));return new this.constructor(...n)}shift(t,e=t){const n=this.points.map(s=>s.shift(t,e));return new this.constructor(...n)}translate(t){return this.shift(t.x,t.y)}equals(t,e,n){const s=this.points.length;if(s!==t.points.length)return!1;const i=n?this:this.oriented,o=n?t:t.oriented;for(let a=0;a<s;++a)if(i.points.every((c,h)=>c.equals(o.points[(h+a)%s],e)))return!0;return!1}toString(){return`polygon(${this.points.join(",")})`}};const D=r=>r.split(" ").map(e=>{const[n,s]=e.split(",").map(Number);return new u(n,s)}),nt=r=>r.map(t=>`${t.x},${t.y}`).join(" ");class be{constructor(t){this.isDragging=!1,this.currentShape=null,this.currentShapeType=null,this.offsetX=0,this.offsetY=0,this.mirrorLines=[],this.imageMap=new Map,this.config=t,this.setupMirrors(),this.initializeShapes(),this.bindEvents()}createShape(t){const e=document.createElementNS("http://www.w3.org/2000/svg",t.type);return Object.entries(t.attributes).forEach(([n,s])=>{e.setAttribute(n,s.toString())}),e.setAttribute("data-shape-id",t.id),e.setAttribute("data-shape-type",t.type),e.setAttribute("data-draggable",t.draggable?"true":"false"),e.setAttribute("role","graphics-symbol"),e.setAttribute("aria-label",`${t.draggable?"Draggable ":""}${t.type}`),t.draggable&&(e.style.cursor="grab"),e}initializeShapes(){const{svg:t,shapes:e,bounds:n}=this.config;t.innerHTML="";const s=3,i=n.width,o=n.height,a=n.x-s*i,c=n.y-s*o,h={id:"room-boundary",type:"path",attributes:{d:p(a,c,i,o,s*2+1),fill:"none",stroke:"#cccccc",strokeWidth:"2"},draggable:!1};function p(m,S,I,$,l){let d="";for(let v=0;v<=l;v++){const A=m+v*I;d+=`M ${A},${S} L ${A},${S+l*$} `}for(let v=0;v<=l;v++){const A=S+v*$;d+=`M ${m},${A} L ${m+l*I},${A} `}return d}[h,...e].forEach(m=>{const S=this.createShape(m);this.buildImages({svg:t,shapeEl:S,shapeData:m}),t.appendChild(S)})}bindEvents(){this.config.svg.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this))}buildCircleImage(t,e){const{svg:n,shapeEl:s,shapeData:i}=t,o=this.reflectCircle(s,e),a=this.createShape({id:i.id,type:"circle",attributes:{cx:o.x,cy:o.y,r:i.attributes.r,fill:P.mix(P.fromHex(i.attributes.fill.toString()),"#fff",.35).toString()},draggable:!1});return n.appendChild(a),this.imageMap.set(t.parentId,[...this.imageMap.get(t.parentId)||[],{shape:a,line:e,id:i.id}]),a}buildPolygonImage(t,e){const{svg:n,shapeEl:s,shapeData:i}=t,o=this.reflectPolygon(s,e)||"",a=this.createShape({id:i.id,type:"polygon",attributes:{points:o,fill:P.mix(P.fromHex(i.attributes.fill.toString()),"#fff",.35).toString()},draggable:!1});return n.appendChild(a),this.imageMap.set(t.parentId,[...this.imageMap.get(t.parentId)||[],{shape:a,line:e,id:i.id}]),a}buildImages(t){const e=this.mirrorLines.length;if(t.shapeData.type==="circle")for(let n=0;n<e;n++){const s={...t,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}`},parentId:t.shapeData.id},i=this.buildCircleImage(s,this.mirrorLines[n]);for(let o=0;o<e;o++){if(n===o)continue;const a={...t,shapeEl:i,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}${o}`},parentId:t.shapeData.id+`reflection${n}`};this.buildCircleImage(a,this.mirrorLines[o])}}else if(t.shapeData.type==="polygon")for(let n=0;n<e;n++){const s={...t,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}`},parentId:t.shapeData.id},i=this.buildPolygonImage(s,this.mirrorLines[n]);for(let o=0;o<e;o++){if(n===o)continue;const a={...t,shapeEl:i,shapeData:{...t.shapeData,id:t.shapeData.id+`reflection${n}${o}`},parentId:t.shapeData.id+`reflection${n}`};this.buildPolygonImage(a,this.mirrorLines[o])}}}setupMirrors(){const{mirrorLocation:t,bounds:e,svg:n}=this.config;if(!t)return;const s=new u(e.x,e.y),i=new u(e.x+e.width,e.y),o=new u(e.x+e.width,e.y+e.height),a=new u(e.x,e.y+e.height);if(["top-bottom","all"].includes(t)){const c=new q(s,i),h=new q(a,o);this.mirrorLines.push(c,h),this.drawMirror(c,"MirrorTop"),this.drawMirror(h,"MirrorBot")}if(["left-right","all"].includes(t)){const c=new q(s,a),h=new q(i,o);this.mirrorLines.push(c,h),this.drawMirror(c,"MirrorLeft"),this.drawMirror(h,"MirrorRight")}}drawMirror(t,e){const[n,s]=[t.p1,t.p2];this.config.shapes.push({id:e,type:"path",attributes:{d:`M ${n.x},${n.y} L ${s.x},${s.y}`,fill:"none",stroke:"#96c8ffd9","stroke-width":6},draggable:!1})}drawRay(t){this.deleteRay();let e=new u(0,0);if(t.tagName.toLowerCase()==="circle"){const i=parseFloat(t.getAttribute("cx")||"0"),o=parseFloat(t.getAttribute("cy")||"0");e=new u(i,o)}else if(t.tagName.toLowerCase()==="polygon"){const i=t.getAttribute("points");e=new Me(...D(i)).centroid}const n=this.config.svg.querySelector('[data-shape-id="observer"]');let s=new u(parseFloat(n.getAttribute("cx")||"0"),parseFloat(n.getAttribute("cy")||"0"));this.drawLine(e,s,{stroke:"#DAA520",attributes:{"data-is-ray":"true","stroke-dasharray":"8,4","stroke-linecap":"round"}})}onMouseDown(t){var a;const e=t.target;if(!e||!(e instanceof SVGGraphicsElement))return;if((a=e.getAttribute("data-shape-id"))==null?void 0:a.includes("reflection")){this.drawRay(e);return}if(!(e.getAttribute("data-draggable")==="true"))return;const i=e.getAttribute("data-shape-type");if(!i)return;this.isDragging=!0,this.currentShape=e,this.currentShapeType=i,this.currentShape.style.cursor="grabbing";const o=this.config.svg.getBoundingClientRect();if(i==="circle"){const c=parseFloat(e.getAttribute("cx")||"0"),h=parseFloat(e.getAttribute("cy")||"0");this.offsetX=t.clientX-o.left-c,this.offsetY=t.clientY-o.top-h}else{const c=parseFloat(D(e.getAttribute("points"))[0].x.toString()),h=parseFloat(D(e.getAttribute("points"))[0].y.toString());this.offsetX=t.clientX-o.left-c,this.offsetY=t.clientY-o.top-h}}deleteRay(){const t=this.config.svg.querySelector('[data-is-ray="true"]');t&&t.remove()}onMouseMove(t){if(!this.isDragging||!this.currentShape||!this.currentShapeType)return;this.deleteRay();const e=this.config.svg.getBoundingClientRect(),n=this.config.bounds;let s=t.clientX-e.left-this.offsetX,i=t.clientY-e.top-this.offsetY;if(this.currentShapeType==="circle"){const o=parseFloat(this.currentShape.getAttribute("r")||"0");s=Math.max(n.x+o,Math.min(s,n.x+n.width-o)),i=Math.max(n.y+o,Math.min(i,n.y+n.height-o)),this.currentShape.setAttribute("cx",s.toString()),this.currentShape.setAttribute("cy",i.toString());const a=this.imageMap.get(this.currentShape.getAttribute("data-shape-id"));for(const c of a||[]){const h=this.reflectCircle(this.currentShape,c.line);c.shape.setAttribute("cx",h.x.toString()),c.shape.setAttribute("cy",h.y.toString());const p=this.imageMap.get(c.id);for(const M of p||[]){const m=this.reflectCircle(c.shape,M.line);M.shape.setAttribute("cx",m.x.toString()),M.shape.setAttribute("cy",m.y.toString())}}}else if(this.currentShapeType==="polygon"){const o=this.currentShape.getAttribute("points");if(!o)return;const a=D(o),c=Math.min(...a.map(x=>x.x)),h=Math.min(...a.map(x=>x.y)),p=Math.max(...a.map(x=>x.x)),M=Math.max(...a.map(x=>x.y)),m=p-c,S=M-h,I=Math.max(n.x,Math.min(s,n.x+n.width-m)),$=Math.max(n.y,Math.min(i,n.y+n.height-S)),l=I-c,d=$-h,v=a.map(x=>new u(x.x+l,x.y+d)),A=nt(v);this.currentShape.setAttribute("points",A);const Pt=this.imageMap.get(this.currentShape.getAttribute("data-shape-id"));for(const x of Pt||[]){const qt=this.reflectPolygon(this.currentShape,x.line);x.shape.setAttribute("points",qt);const It=this.imageMap.get(x.id);for(const W of It||[]){const $t=this.reflectPolygon(x.shape,W.line);W.shape.setAttribute("points",$t)}}}}getShapeSize(t){const e=t.getBBox();return{width:e.width,height:e.height}}onMouseUp(){this.currentShape&&(this.currentShape.style.cursor="grab"),this.isDragging=!1,this.currentShape=null,this.currentShapeType=null}reflectCircle(t,e){if(t.getAttribute("data-shape-type")!=="circle")return;const n=parseFloat(t.getAttribute("cx")||"0"),s=parseFloat(t.getAttribute("cy")||"0");return new u(n,s).reflect(e)}reflectPolygon(t,e){if(t.getAttribute("data-shape-type")!=="polygon")return;const s=D(t.getAttribute("points")).map(i=>i.reflect(e));return nt(s)}drawLine(t,e,n={}){const{stroke:s="#000000",strokeWidth:i=2,id:o=`line-${Math.random().toString(36).substr(2,9)}`,draggable:a=!1,attributes:c={}}=n,h={id:o,type:"path",attributes:{d:`M ${t.x},${t.y} L ${e.x},${e.y}`,fill:"none",stroke:s,"stroke-width":i,...c},draggable:a},p=this.createShape(h);return this.config.svg.appendChild(p),p}updateShapes(t){this.config.shapes=t,this.initializeShapes()}updateBounds(t){this.config.bounds=t}destroy(){window.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("mouseup",this.onMouseUp.bind(this))}}const we=[{id:"observer",type:"circle",attributes:{cx:500,cy:350,r:15,fill:"#0000c8"},draggable:!0},{id:"poly1",type:"polygon",attributes:{points:"450,400 525,400 525,450 475,440 450,450 475,425",fill:"#c80000"},draggable:!0}],Se={x:400,y:300,width:200,height:200},ve={svg:document.querySelector("svg"),shapes:we,bounds:Se,mirrorLocation:"all"};new be(ve);
